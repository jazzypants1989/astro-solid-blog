const y=document.getElementById("login");y.addEventListener("click",()=>{window.location.href="/api/auth"});function w(r,e){if(["link","go"].includes(r))if(e){const t=document.querySelector(e);t?t.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:0})}else window.scrollTo({top:0})}function d(r){const e=new URL(r||window.location.href).href;return e.endsWith("/")||e.includes(".")||e.includes("#")?e:`${e}/`}function E(r){(!window.history.state||window.history.state.url!==r)&&window.history.pushState({url:r},"internalLink",r)}function k(r){document.querySelector(r).scrollIntoView({behavior:"smooth",block:"start"})}function L(r){return{type:"popstate",next:d()}}function F(r){var e;let t;if(r.altKey||r.ctrlKey||r.metaKey||r.shiftKey)return{type:"disqualified"};for(let o=r.target;o.parentNode;o=o.parentNode)if(o.nodeName==="A"){t=o;break}if(t&&t.host!==location.host)return t.target="_blank",{type:"external"};if(t&&"cold"in t?.dataset)return{type:"disqualified"};if(t!=null&&t.hasAttribute("href")){const o=t.getAttribute("href"),n=new URL(o,location.href);if(r.preventDefault(),o!=null&&o.startsWith("#"))return k(o),{type:"scrolled"};const i=(e=o.match(/#([\w'-]+)\b/g))==null?void 0:e[0],s=d(n.href),c=d();return{type:"link",next:s,prev:c,scrollId:i}}else return{type:"noop"}}function A(r){return new DOMParser().parseFromString(r,"text/html")}function m(r){document.body.querySelectorAll("[flamethrower-preserve]").forEach(e=>{let t=r.body.querySelector('[flamethrower-preserve][id="'+e.id+'"]');if(t){const o=e.cloneNode(!0);t.replaceWith(o)}}),document.body.replaceWith(r.body)}function q(r){const e=s=>Array.from(s.querySelectorAll('head>:not([rel="prefetch"]')),t=e(document),o=e(r),{staleNodes:n,freshNodes:i}=N(t,o);n.forEach(s=>s.remove()),document.head.append(...i)}function N(r,e){const t=[],o=[];let n=0,i=0;for(;n<r.length||i<e.length;){const s=r[n],c=e[i];if(s!=null&&s.isEqualNode(c)){n++,i++;continue}const h=s?o.findIndex(l=>l.isEqualNode(s)):-1;if(h!==-1){o.splice(h,1),n++;continue}const a=c?t.findIndex(l=>l.isEqualNode(c)):-1;if(a!==-1){t.splice(a,1),i++;continue}s&&t.push(s),c&&o.push(c),n++,i++}return{staleNodes:t,freshNodes:o}}function g(){document.head.querySelectorAll("[data-reload]").forEach(v),document.body.querySelectorAll("script").forEach(v)}function v(r){const e=document.createElement("script"),t=Array.from(r.attributes);for(const{name:o,value:n}of t)e[o]=n;e.append(r.textContent),r.replaceWith(e)}const S={log:!1,pageTransitions:!1};class x{constructor(e){this.opts=e,this.enabled=!0,this.prefetched=new Set,this.opts={...S,...e??{}},window!=null&&window.history?(document.addEventListener("click",t=>this.onClick(t)),window.addEventListener("popstate",t=>this.onPop(t)),this.prefetch()):(console.warn("flamethrower router not supported in this browser or environment"),this.enabled=!1)}go(e){const t=window.location.href,o=new URL(e,location.origin).href;return this.reconstructDOM({type:"go",next:o,prev:t})}back(){window.history.back()}forward(){window.history.forward()}get allLinks(){return Array.from(document.links).filter(e=>e.href.includes(document.location.origin)&&!e.href.includes("#")&&e.href!==(document.location.href||document.location.href+"/")&&!this.prefetched.has(e.href))}log(...e){this.opts.log&&console.log(...e)}prefetch(){if(this.opts.prefetch==="visible")this.prefetchVisible();else if(this.opts.prefetch==="hover")this.prefetchOnHover();else return}prefetchOnHover(){this.allLinks.forEach(e=>{const t=e.getAttribute("href");e.addEventListener("pointerenter",()=>this.createLink(t),{once:!0})})}prefetchVisible(){const e={root:null,rootMargin:"0px",threshold:1};"IntersectionObserver"in window&&(this.observer||(this.observer=new IntersectionObserver((t,o)=>{t.forEach(n=>{const i=n.target.getAttribute("href");if(this.prefetched.has(i)){o.unobserve(n.target);return}n.isIntersecting&&(this.createLink(i),o.unobserve(n.target))})},e)),this.allLinks.forEach(t=>this.observer.observe(t)))}createLink(e){const t=document.createElement("link");t.rel="prefetch",t.href=e,t.as="document",t.onload=()=>this.log("\u{1F329}\uFE0F prefetched",e),t.onerror=o=>this.log("\u{1F915} can't prefetch",e,o),document.head.appendChild(t),this.prefetched.add(e)}onClick(e){this.reconstructDOM(F(e))}onPop(e){this.reconstructDOM(L())}async reconstructDOM({type:e,next:t,prev:o,scrollId:n}){if(!this.enabled){this.log("router disabled");return}try{if(this.log("\u26A1",e),["popstate","link","go"].includes(e)&&t!==o){this.opts.log&&console.time("\u23F1\uFE0F"),window.dispatchEvent(new CustomEvent("flamethrower:router:fetch")),e!="popstate"&&E(t);const i=await(await fetch(t,{headers:{"X-Flamethrower":"1"}}).then(c=>{const h=c.body.getReader(),a=parseInt(c.headers.get("Content-Length"));let l=0;return new ReadableStream({start(u){function f(){h.read().then(({done:b,value:p})=>{if(b){u.close();return}l+=p.length,window.dispatchEvent(new CustomEvent("flamethrower:router:fetch-progress",{detail:{progress:Number.isNaN(a)?0:l/a*100,received:l,length:a||0}})),u.enqueue(p),f()})}f()}})}).then(c=>new Response(c,{headers:{"Content-Type":"text/html"}}))).text(),s=A(i);q(s),this.opts.pageTransitions&&document.createDocumentTransition?document.createDocumentTransition().start(()=>{m(s),g(),w(e,n)}):(m(s),g(),w(e,n)),window.dispatchEvent(new CustomEvent("flamethrower:router:end")),setTimeout(()=>{this.prefetch()},200),this.opts.log&&console.timeEnd("\u23F1\uFE0F")}}catch(i){return window.dispatchEvent(new CustomEvent("flamethrower:router:error",i)),this.opts.log&&console.timeEnd("\u23F1\uFE0F"),console.error("\u{1F4A5} router fetch failed",i),!1}}}const I=r=>{const e=new x(r);if(r.log&&console.log("\u{1F525} flamethrower engaged"),window){const t=window;t.flamethrower=e}return e},C=I({prefetch:"visible",log:!0,pageTransitions:!0});document.querySelectorAll(".Link").forEach(r=>{r.addEventListener("click",e=>{e.preventDefault(),C.go(r.getAttribute("href"))})});window.addEventListener("flamethrower:router:fetch-progress",({detail:r})=>{const e=document.querySelector("#loader");r.progress===1?e.classList.add("hidden"):e.classList.remove("hidden")});
