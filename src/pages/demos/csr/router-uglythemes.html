<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tell me this isn't an SPA</title>
  </head>
  <style>
    .dark {
      background-color: #222;
      color: #fff;
    }
    .dark a {
      color: #88f;
    }
    .purple {
      background-color: #88f;
      color: #222;
    }
    .purple a {
      color: #292;
    }
    .green {
      background-color: #0f0;
      color: #911;
    }
    .green a {
      color: #999;
    }
  </style>
  <body class="dark">
    <nav>
      <ul>
        <li>
          <a href="/" class="Link">Home</a>
        </li>
        <li>
          <a href="/about" class="Link">About</a>
        </li>
        <li>
          <a href="/products" class="Link">Products</a>
        </li>
        <li>
          <a href="/cart" class="Link">Cart </a>
        </li>
      </ul>
    </nav>
    <button id="toggleTheme">Toggle Theme</button>
    <main class="main"></main>
    <footer>
      <a href="http://jazzypants.dev"> Â© 2023 Jovial Penguin, LLC.</a>
    </footer>
    <script defer>
      const main = document.querySelector(".main") // Get the main element, which will be used to render the dynamic content
      const links = document.querySelectorAll(".Link") // instead of targeting every anchor tag, we only target the ones meant for navigating around our app.
      const path = window.location.pathname // Get the current path from the URL entered in the browser
      const toggleTheme = document.querySelector("#toggleTheme") // Get the toggleTheme button

      toggleTheme.addEventListener("click", () => {
        // Check current theme
        const currentTheme = document.body.className
        // Toggle theme
        if (currentTheme === "dark") {
          document.body.className = "purple"
        } else if (currentTheme === "purple") {
          document.body.className = "green"
        } else {
          document.body.className = "dark"
        }
      })

      const Routes = {
        "/": () => (main.innerHTML = "<h1>Home</h1>"),
        "/about": () => (main.innerHTML = "<h1>About</h1>"),
        "/products": () => (main.innerHTML = "<h1>Products</h1>"),
        "/cart": () => (main.innerHTML = "<h1>Cart</h1>"),
      } // Here, we defined all of our routes and associated them with a view function. These functions will be called if the route is matched with the URL parameters from the path.

      const Router = (match) => {
        // define the Router function,
        if (Routes[match]) {
          // if the path exists in the Routes object,
          Routes[match]() // call the associated view function
        } else {
          // otherwise,
          main.innerHTML = `<h1>Huh, you're at ${path}, but you really shouldn't be</h1>` // render the 404 page
        }
      }

      links.forEach((link) => {
        // Target each link that we have targeted with the Link class,
        link.addEventListener("click", (e) => {
          // add a click event listener
          e.preventDefault() // prevent the default behavior of the anchor tag
          const linkPath = link.getAttribute("href") // get the href attribute of the link
          history.pushState(null, null, linkPath) // push the link's path to the history object
          Router(linkPath) // call the Router function with the link's path
        }) // Ta-da! We have a SPA! Oh, wait. We need to call the Router function once to render the initial page.
      })

      Router(path) // After the rest of the script has loaded, call the Router function with the current path to render the correct View.

      window.addEventListener("DOMContentLoaded", () => {
        // when the DOM is loaded,
        window.addEventListener("popstate", () => {
          // add a popstate event listener since it isn't triggered by internal Link clicks and it is slow to load
          Router(path) // if the popstate event is triggered, call the Router function with the current path
        })
      })
    </script>
  </body>
</html>
