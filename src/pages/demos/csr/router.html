<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tell me this isn't an SPA</title>
  </head>
  <body>
    <nav>
      <ul>
        <li>
          <a href="/" class="Link">Home</a>
        </li>
        <li>
          <a href="/about" class="Link">About</a>
        </li>
        <li>
          <a href="/products" class="Link">Products</a>
        </li>
        <li>
          <a href="/cart" class="Link">Cart </a>
        </li>
      </ul>
    </nav>
    <main class="main"></main>
    <footer>Jovial Penguin LLC. Â©</footer>
    <script defer>
      const main = document.querySelector(".main") // Get the main element, which will be used to render the dynamic content
      const links = document.querySelectorAll(".Link") // instead of targeting every anchor tag, we target only the internal links (in case we have external links in the future)

      const routes = {
        // define all potential routes and associate them with a view function. These functions will be called when the route is matched, and will be passed the URL parameters from the path.
        "/": () => (main.innerHTML = "<h1>Home</h1>"),
        "/about": () => (main.innerHTML = "<h1>About</h1>"),
        "/products": () => (main.innerHTML = "<h1>Products</h1>"),
        "/cart": () => (main.innerHTML = "<h1>Cart</h1>"),
      }

      const router = (path) => {
        // define the router function,
        if (routes[path]) {
          // if the path exists in the routes object,
          routes[path]() // call the associated view function
        } else {
          // otherwise,
          main.innerHTML = `Huh, you're at ${path}, but you really shouldn't be` // render the 404 page
        }
      }

      links.forEach((link) => {
        // Target each link that we have targeted with the Link class,
        link.addEventListener("click", (e) => {
          // add a click event listener
          e.preventDefault() // prevent the default behavior of the anchor tag
          const path = e.target.getAttribute("href") // get the href attribute of the anchor tag
          history.pushState(null, null, path) // push the path to the history object
          router(path) // call the router function with the path
        }) // Ta-da! We have a SPA! Well, let's make sure the HTML loads before we call the router function...
      })

      window.addEventListener("DOMContentLoaded", () => {
        // when the DOM is loaded,
        router(window.location.pathname) // call the router function with the current path

        window.addEventListener("popstate", () => {
          // add a popstate event listener since it isn't triggered by internal Link clicks and it is slow to load
          router(window.location.pathname) // call the router function with the current path if the user clicks the back or forward button
        })
      })
    </script>
  </body>
</html>
